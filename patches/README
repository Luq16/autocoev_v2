# Install CAPS, either as dynamic or static binary. Then, install the
# rest of the programs that AutoCoEv drives. Below are instructions for
# Debian/Ubuntu, tested on Ubuntu 20.04 (LTS). For the programs that are
# not available as packages, you may wish to check the corresponding web-
# sites to get the latest versions. Patches are discussed in the bottom.

# These are available as packages:
sudo apt install muscle mafft datamash ncbi-blast+ exonerate prank squizz parallel phyml r-base

# Build Guidance (http://guidance.tau.ac.il/) it needs BioPerl and co:
sudo apt install bioperl
sudo apt install libbio-coordinate-perl libbio-db-ace-perl libbio-eutilities-perl libbio-procedural-perl libbio-samtools-perl
wget http://guidance.tau.ac.il/guidance.v2.02.tar.gz
tar xvf guidance.v2.02.tar.gz
cd guidance.v2.02
make
cd ..

# I know /usr/local/lib is better, but for now place it here:
sudo cp -a guidance.v2.02 /usr/lib/guidance

# Get Gblocks (http://molevol.cmima.csic.es/castresana/Gblocks.html):
wget http://molevol.cmima.csic.es/castresana/Gblocks/Gblocks_Linux64_0.91b.tar.Z
tar xvf Gblocks_Linux64_0.91b.tar.Z
sudo cp Gblocks_0.91b/Gblocks /usr/local/bin

# Get SeqKit (https://bioinf.shenwei.me/seqkit/)
wget https://github.com/shenwei356/seqkit/releases/download/v2.1.0/seqkit_linux_amd64.tar.gz
tar xvf seqkit_linux_amd64.tar.gz
sudo cp seqkit /usr/local/bin

# Build TreeBeST Ensembl mod (https://github.com/Ensembl/treebest/)
sudo apt install flex bison
wget https://github.com/Ensembl/treebest/archive/347fa82/treebest-347fa82a0ce1c169849053fdc9ff7d19d221f290.tar.gz
tar xvf treebest-347fa82a0ce1c169849053fdc9ff7d19d221f290.tar.gz
cd treebest-347fa82a0ce1c169849053fdc9ff7d19d221f290
make
sudo cp treebest /usr/local/bin

# AutoCoEv uses phyml executable directly, not through the wrapper
# provided by Debian/Ubuntu. Therefore, make a symlink:
cd /usr/local/bin
ln -s ../../lib/phyml/bin/phyml .

# AutoCoEv expects to find MAFFT aliases in your $PATH. Either add
# /usr/lib/mafft/bin to your $PATH or create symlinks, like this:
cd /usr/local/bin
ln -s ../../lib/mafft/mafft-linsi .


# It has come to my attention, that fastaindex produces an empty file on
# Debian and Ubuntu (at least in a virtual machine). I am trying to
# resolve the issue at the moment. If you have this problem, download
# the indexed database 'odb10v1_all_fasta.tab.index.tar.gz' from:
# https://seafile.utu.fi/d/a8de85062abf4ab68de9/
# Then extract and place in its proper location:
tar xvf odb10v1_all_fasta.tab.index.tar.gz
mv odb10v1_all_fasta.tab.index /var/tmp/DB10v1


# Check caps-dynamic and caps-statit for building and installing CAPS2.
# You can just grab the precompiled static binary and go with it.
